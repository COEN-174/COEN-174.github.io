<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senior Design Judging</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.22/webcomponents-lite.min.js"></script>
    <link rel="import" href="common.html">
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="import" type="text/html" id="form_template" href="judging/form.html">
</head>
<body unresolved>
<dom-module id="app-main">
    <template>
        <paper-drawer-panel>
            <paper-header-panel drawer id="drawer-panel">
                <paper-toolbar>
                    <iron-image sizing="contain" id="hero_image" src="img/hero_logo_white.png"></iron-image>
                </paper-toolbar>
                <template is="dom-bind" id="projects_sidebar">
                    <paper-menu id="sidebar_menu" selected="0">
                        <template is="dom-repeat" items="{{project_list}}">
                            <paper-item class="sidebar_cell">
                                {{item.name}}
                                <paper-ripple></paper-ripple>
                            </paper-item>
                            <div class="sidebar_cell_separator"></div>
                        </template>
                    </paper-menu>
                </template>
            </paper-header-panel>
            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button id="menu_button" icon="menu" paper-drawer-toggle></paper-icon-button>
                    <span style="flex: 1;"></span>
                    <paper-icon-button id="exit_button" on-tap="logout_handler" icon="exit-to-app"></paper-icon-button>
                    <paper-tooltip for="menu_button" offset="20">projects</paper-tooltip>
                    <paper-tooltip for="exit_button" offset="20">logout</paper-tooltip>
                </paper-toolbar>
                <div id="prototype_div"></div>
                <paper-toast id="successToast" text="Form Submitted"></paper-toast>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
        var login_location = "./login";
        var team_members;
        document.addEventListener('WebComponentsReady', function() {
            Polymer({
                is: "app-main",
                logout_handler: function() {
                    window.location = login_location;
                },
                ready: function() {
                    projectArr(function(result) {
                        if (result.length) {
                            var projects_sidebar = document.querySelector('#projects_sidebar');
                            projects_sidebar.project_list = result;
                            finishPageSetup();
                        }
                    });
                }
            });
        });
        function finishPageSetup() {
            var menu = document.getElementById('sidebar_menu');
            menu.addEventListener("iron-select", function(){
                team_members = _projectArr[menu.selected/2].members;

                document.querySelector('#prototype_div').innerHTML = "";
                var form_template_import = document.querySelector('#form_template');
                var form_template_content = form_template_import.import.querySelector('#judging_form');
                var form_clone = form_template_content.cloneNode(true);
                form_clone.classList += "form_container_transition";
                document.querySelector('#prototype_div').appendChild(form_clone);

                var teamContainer = document.getElementById("team_container");
                teamContainer.innerHTML = "";
                for (var stringidx = 0; stringidx < team_members.length; stringidx++) {
                    teamContainer.innerHTML += "<div class=\"chip\">"+team_members[stringidx]+"</div>";
                }
            });
        }
        function _submit(event) {
//            Polymer.dom(event).localTarget.parentElement.submit();
            successToast.open();
        }
        function _reset(event) {
            var form = Polymer.dom(event).localTarget.parentElement
            form.reset();
            form.querySelector('.output').innerHTML = '';
        }
        if (typeof(Storage) == "undefined") { }
        _userId = sessionStorage.getItem("user_id");
        if (_userId == null) {
            window.location = login_location;
        }
    </script>
</dom-module>
<app-main></app-main>
</body>
</html>