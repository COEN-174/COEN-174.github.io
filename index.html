<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senior Design Judging</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.22/webcomponents-lite.min.js"></script>
    <link rel="import" href="common.html">
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="import" type="text/html" id="form_template" href="judging/form.html">
    <link rel="import" type="text/html" id="form_advisor_template" href="judging/form_advisor.html">
</head>
<body unresolved>
<dom-module id="app-main">
    <template>
        <paper-drawer-panel>
            <paper-header-panel drawer id="drawer-panel">
                <paper-toolbar>
                    <iron-image sizing="contain" id="hero_image" src="img/hero_logo_white.png"></iron-image>
                </paper-toolbar>
                <template is="dom-bind" id="projects_sidebar">
                    <paper-menu id="sidebar_menu" selected="0">
                        <template is="dom-repeat" items="{{project_list}}">
                            <paper-item class="sidebar_cell noselect">
                                {{item.name}}
                                <paper-ripple></paper-ripple>
                            </paper-item>
                            <div class="sidebar_cell_separator"></div>
                        </template>
                    </paper-menu>
                </template>
            </paper-header-panel>
            <paper-header-panel main>
                <paper-toolbar id="main_header_toolbar">
                    <paper-icon-button id="menu_button" icon="menu" paper-drawer-toggle></paper-icon-button>
                    <span style="flex: 1;"></span>
                    <paper-button id="download_button" hidden>Download</paper-button>
                    <paper-icon-button id="help_button" on-tap="show_help_dialog" icon="help"></paper-icon-button>
                    <span style="margin-left: 10px;"></span>
                    <paper-icon-button id="exit_button" on-tap="logout_handler" icon="exit-to-app"></paper-icon-button>
                    <paper-tooltip for="menu_button" offset="20">projects</paper-tooltip>
                    <paper-tooltip for="exit_button" offset="20">logout</paper-tooltip>
                    <paper-tooltip for="help_button" offset="20">help</paper-tooltip>
                </paper-toolbar>
                <div id="prototype_div"></div>
                <paper-toast id="successToast" text="Form Submitted"></paper-toast>
            </paper-header-panel>
        </paper-drawer-panel>

        <paper-dialog id="help_dialog" with-backdrop>
            <h2>Senior Design Judging</h2>
            <p>Please evaluate senior engineering design projects and presentation using the following point system:</p>
            <li>5 = Excellent (at the level of an entry-level engineer you would hire)</li>
            <li>4 = Good (at the level of an accomplished college senior)</li>
            <li>3 = Average (at the level of a typical college senior)</li>
            <li>2 = Below Average (not up to the expectations for a college senior)</li>
            <li>1 = Poor (significant errors or omissions)</li>
            <li>N/A = No appropriate score applies</li>
            <p>At the end of the judging form, click "Submit" to submit your scores</p>
            <div class="buttons">
                <paper-button dialog-dismiss autofocus class="help-dialog-button">Got it</paper-button>
            </div>
        </paper-dialog>
    </template>

    <script>
        var login_location = "./login";
        var team_members;
        document.addEventListener('WebComponentsReady', function() {
            Polymer({
                is: "app-main",
                logout_handler: function() {
                    window.location = login_location;
                },
                show_help_dialog: function() {
                    help_dialog.open()
                },
                ready: function() {
                    if(_userIsJudge) {
                        help_dialog.open();
                    }
                    projectArr(function(result) {
                        if (result.length) {
                            var projects_sidebar = document.querySelector('#projects_sidebar');
                            projects_sidebar.project_list = result;
                            finishPageSetup();
                        }
                    });
                }
            });
        });
        function finishPageSetup() {
            var menu = document.getElementById('sidebar_menu');
            menu.addEventListener("iron-select", function(){
                team_members = _projectArr[menu.selected/2].members;

                document.querySelector('#prototype_div').innerHTML = "";
                var form_clone;
                if (_userIsJudge) {
                    var form_template_import = document.querySelector('#form_template');
                    var form_template_content = form_template_import.import.querySelector('#judging_form');
                    form_clone = form_template_content.cloneNode(true);
                } else {
                    var form_template_import = document.querySelector('#form_advisor_template');
                    var form_template_content = form_template_import.import.querySelector('#advisor_form');
                    form_clone = form_template_content.cloneNode(true);

                    document.querySelector('#download_button').removeAttribute("hidden");
                }
                form_clone.classList += "form_container_transition";
                document.querySelector('#prototype_div').appendChild(form_clone);

                var teamContainer = document.getElementById("team_container");
                teamContainer.innerHTML = "";
                for (var stringidx = 0; stringidx < team_members.length; stringidx++) {
                    teamContainer.innerHTML += "<div class=\"chip noselect\">"+team_members[stringidx]+"</div>";
                }

//                var titleBanner = document.getElementById('welcome_banner');
//                titleBanner.innerHTML = _projectArr[menu.selected/2].name;
            });
        }
        function _submit(event) {
//            Polymer.dom(event).localTarget.parentElement.submit();
            successToast.open();
        }
        function _reset(event) {
            var form = Polymer.dom(event).localTarget.parentElement
            form.reset();
            form.querySelector('.output').innerHTML = '';
        }
        if (typeof(Storage) == "undefined") { }
        _userId = sessionStorage.getItem("user_id");
        if (_userId == null) {
            window.location = login_location;
        }
    </script>
</dom-module>
<app-main></app-main>
</body>
</html>