<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <base href="..">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.22/webcomponents-lite.min.js"></script>
    <link rel="import" href="common.html">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <style is="custom-style">
        .flex-horizontal {
            @apply(--layout-horizontal);
        }
        .flexchild {
            @apply(--layout-flex);
        }
    </style>
</head>
<body unresolved>
    <div id="container">
        <div id="rotate_container">
            <div class="input_label" class="noselect" id="welcome_banner">Sign in</div>
            <div class="input_label" class="noselect" id="name_banner"></div>
        </div>

        <div id="passcode_input" class="container flex-horizontal">
            <paper-input class="flexchild" label="Passcode"></paper-input>
            <paper-icon-button disabled=true id="submit_button" icon="arrow-forward" title="submit"></paper-icon-button>
        </div>
    </div>
    <script>
        if (typeof(Storage) == "undefined") { }
        sessionStorage.removeItem("user_id");

        var userObj;
        document.querySelector('paper-icon-button').addEventListener('click', function(event) {
            if (userObj) {
                if (typeof(Storage) == "undefined") { }
                sessionStorage.setItem("user_id", userObj.id);
                window.location = ".";
            }
        });
        document.querySelector('paper-input').addEventListener('keyup', function(event) {
            searchJudgesAuth(event.target.value, function(result) {
                if (result) {
                    document.getElementById("name_banner").innerHTML = result.name;
                    applyStateDisabled(false);
                    userObj = result;
                } else {
                    searchAdvisorsAuth(event.target.value, function(advisorObj) {
                        if (advisorObj) {
                            document.getElementById("name_banner").innerHTML = advisorObj.name;
                            applyStateDisabled(false);
                            userObj = advisorObj;
                        } else {
                            searchAdminAuth(event.target.value, function(adminObj) {
                                if (adminObj) {
                                    document.getElementById("name_banner").innerHTML = adminObj.name;
                                    applyStateDisabled(false);
                                    userObj = adminObj;
                                } else {
                                    applyStateDisabled(true);
                                    userObj = null;
                                }
                            });
                        }
                    });
                }
            });
        });
        function applyStateDisabled(disabled) {
            var rotate_container = document.getElementById("rotate_container");
            var submit_button = document.getElementById("submit_button");
            if (disabled) {
                submit_button.disabled = true;
                submit_button.classList.remove('submit_button_enabled');
                rotate_container.classList.remove('container_rotated');
            } else {
                submit_button.disabled = false;
                submit_button.classList.add('submit_button_enabled');
                rotate_container.classList.add('container_rotated');
            }
        }
    </script>
</body>
</html>
